// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                      String                       @id @default(uuid())
  clerkUserId             String                    @unique
  email                   String                    @unique
  name                    String?
  imageUrl                String?
  academic_level          String?
  birthdate               DateTime?
  created_at              DateTime                  @default(now())
  updated_at              DateTime                  @updatedAt
  
  // Relaciones
  categories              Category[]
  tasks                   Task[]
  saved_recommendations   SavedRecommendation[]
  recommendation_feedback RecommendationFeedback[]

  @@map("users")
}

model Category {
  id         String      @id @default(uuid())
  user_id    String
  name       String   
  color      String?
  created_at DateTime @default(now())
  
  // Relaciones
  user  User   @relation(fields: [user_id], references: [clerkUserId], onDelete: Cascade)
  tasks Task[]

  @@map("categories")
}

model Task {
  id                    String                       @id @default(uuid())
  user_id               String
  category_id           String
  title                 String
  description           String?                   @db.Text
  due_date              DateTime?
  start_date            DateTime?
  estimated_duration       Int?
  status                TaskStatus                @default(TODO)
  notes                 String?                   @db.Text
  is_completed          Boolean                   @default(false)
  completed_at          DateTime?
  created_at            DateTime                  @default(now())
  updated_at            DateTime                  @updatedAt
  
  // Relaciones
  user                  User                      @relation(fields: [user_id], references: [clerkUserId], onDelete: Cascade)
  category              Category?                 @relation(fields: [category_id], references: [id], onDelete: SetNull)
  saved_recommendations SavedRecommendation[]

  @@map("tasks")
}

model SavedRecommendation {
  id            String      @id @default(uuid())
  task_id       String
  user_id       String
  title         String
  description   String?  @db.Text
  url           String
  type          String   // video, article, academic
  source        String   // YouTube, Wikipedia, etc.
  thumbnail_url String?
  saved_at      DateTime @default(now())
  
  // Relaciones
  task                    Task                     @relation(fields: [task_id], references: [id], onDelete: Cascade)
  user                    User                     @relation(fields: [user_id], references: [clerkUserId], onDelete: Cascade)
  recommendation_feedback RecommendationFeedback[]

  @@map("saved_recommendations")
}

model RecommendationFeedback {
  id                       String     @id @default(uuid())
  user_id                  String
  saved_recommendation_id  String
  recommendation_title     String
  is_useful                Boolean
  created_at               DateTime @default(now())
  
  // Relaciones
  user                User                 @relation(fields: [user_id], references: [clerkUserId], onDelete: Cascade)
  saved_recommendation SavedRecommendation? @relation(fields: [saved_recommendation_id], references: [id], onDelete: SetNull)

  @@map("recommendation_feedback")
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  COMPLETED
}

// npm i -D prisma
// npx prisma init
// npx prisma generate
// npx prisma migrate dev